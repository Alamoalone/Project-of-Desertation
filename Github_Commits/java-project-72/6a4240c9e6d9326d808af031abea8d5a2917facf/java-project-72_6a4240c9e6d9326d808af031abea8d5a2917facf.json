{
    "sha": "6a4240c9e6d9326d808af031abea8d5a2917facf",
    "node_id": "C_kwDOLG8GfdoAKDZhNDI0MGM5ZTZkOTMyNmQ4MDhhZjAzMWFiZWE4ZDVhMjkxN2ZhY2Y",
    "commit": {
        "author": {
            "name": "serebrianskii",
            "email": "serebrianskiik@gmail.com",
            "date": "2024-02-02T20:13:01Z"
        },
        "committer": {
            "name": "serebrianskii",
            "email": "serebrianskiik@gmail.com",
            "date": "2024-02-02T20:17:47Z"
        },
        "message": "Fix bug with null pointer exception on invalid url check\n\nFailed to create test that check flash message",
        "tree": {
            "sha": "d6d18a91abaa21d588a5370f3c414571afd574c5",
            "url": "https://api.github.com/repos/SerKonstantin/java-project-72/git/trees/d6d18a91abaa21d588a5370f3c414571afd574c5"
        },
        "url": "https://api.github.com/repos/SerKonstantin/java-project-72/git/commits/6a4240c9e6d9326d808af031abea8d5a2917facf",
        "comment_count": 0,
        "verification": {
            "verified": false,
            "reason": "unsigned",
            "signature": null,
            "payload": null
        }
    },
    "url": "https://api.github.com/repos/SerKonstantin/java-project-72/commits/6a4240c9e6d9326d808af031abea8d5a2917facf",
    "html_url": "https://github.com/SerKonstantin/java-project-72/commit/6a4240c9e6d9326d808af031abea8d5a2917facf",
    "comments_url": "https://api.github.com/repos/SerKonstantin/java-project-72/commits/6a4240c9e6d9326d808af031abea8d5a2917facf/comments",
    "author": {
        "login": "SerKonstantin",
        "id": 139151619,
        "node_id": "U_kgDOCEtJAw",
        "avatar_url": "https://avatars.githubusercontent.com/u/139151619?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/SerKonstantin",
        "html_url": "https://github.com/SerKonstantin",
        "followers_url": "https://api.github.com/users/SerKonstantin/followers",
        "following_url": "https://api.github.com/users/SerKonstantin/following{/other_user}",
        "gists_url": "https://api.github.com/users/SerKonstantin/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/SerKonstantin/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/SerKonstantin/subscriptions",
        "organizations_url": "https://api.github.com/users/SerKonstantin/orgs",
        "repos_url": "https://api.github.com/users/SerKonstantin/repos",
        "events_url": "https://api.github.com/users/SerKonstantin/events{/privacy}",
        "received_events_url": "https://api.github.com/users/SerKonstantin/received_events",
        "type": "User",
        "site_admin": false
    },
    "committer": {
        "login": "SerKonstantin",
        "id": 139151619,
        "node_id": "U_kgDOCEtJAw",
        "avatar_url": "https://avatars.githubusercontent.com/u/139151619?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/SerKonstantin",
        "html_url": "https://github.com/SerKonstantin",
        "followers_url": "https://api.github.com/users/SerKonstantin/followers",
        "following_url": "https://api.github.com/users/SerKonstantin/following{/other_user}",
        "gists_url": "https://api.github.com/users/SerKonstantin/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/SerKonstantin/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/SerKonstantin/subscriptions",
        "organizations_url": "https://api.github.com/users/SerKonstantin/orgs",
        "repos_url": "https://api.github.com/users/SerKonstantin/repos",
        "events_url": "https://api.github.com/users/SerKonstantin/events{/privacy}",
        "received_events_url": "https://api.github.com/users/SerKonstantin/received_events",
        "type": "User",
        "site_admin": false
    },
    "parents": [
        {
            "sha": "64ebf08f725df5ad65f020faed7baf6fd42c4ce1",
            "url": "https://api.github.com/repos/SerKonstantin/java-project-72/commits/64ebf08f725df5ad65f020faed7baf6fd42c4ce1",
            "html_url": "https://github.com/SerKonstantin/java-project-72/commit/64ebf08f725df5ad65f020faed7baf6fd42c4ce1"
        }
    ],
    "stats": {
        "total": 32,
        "additions": 28,
        "deletions": 4
    },
    "files": [
        {
            "sha": "a1c56090a195fdac5e9f998742cfed7dfb5978da",
            "filename": "app/src/main/java/hexlet/code/controller/UrlsController.java",
            "status": "modified",
            "additions": 7,
            "deletions": 3,
            "changes": 10,
            "blob_url": "https://github.com/SerKonstantin/java-project-72/blob/6a4240c9e6d9326d808af031abea8d5a2917facf/app%2Fsrc%2Fmain%2Fjava%2Fhexlet%2Fcode%2Fcontroller%2FUrlsController.java",
            "raw_url": "https://github.com/SerKonstantin/java-project-72/raw/6a4240c9e6d9326d808af031abea8d5a2917facf/app%2Fsrc%2Fmain%2Fjava%2Fhexlet%2Fcode%2Fcontroller%2FUrlsController.java",
            "contents_url": "https://api.github.com/repos/SerKonstantin/java-project-72/contents/app%2Fsrc%2Fmain%2Fjava%2Fhexlet%2Fcode%2Fcontroller%2FUrlsController.java?ref=6a4240c9e6d9326d808af031abea8d5a2917facf",
            "patch": "@@ -28,9 +28,13 @@ public static void index(Context ctx) throws SQLException {\n     }\n \n     public static void create(Context ctx) throws SQLException {\n-        var userInput = ctx.formParam(\"url\").trim().toLowerCase();\n+        var userInput = ctx.formParam(\"url\");\n+        if (userInput != null) {\n+            userInput = userInput.trim().toLowerCase();\n+        }\n \n         try {\n+            assert userInput != null;\n             if (!userInput.startsWith(\"http://\") && !userInput.startsWith(\"https://\")) {\n                 userInput = \"https://\" + userInput;\n             }\n@@ -68,7 +72,7 @@ public static void create(Context ctx) throws SQLException {\n             } else {\n                 throw new URISyntaxException(userInput, \"Invalid URL\");\n             }\n-        } catch (URISyntaxException e) {\n+        } catch (AssertionError | URISyntaxException e) {\n             ctx.sessionAttribute(\"flash\", \"Некорректный URL\"); // TODO check message\n             ctx.sessionAttribute(\"flashType\", \"danger\");\n             ctx.redirect(Routes.rootPath());\n@@ -104,7 +108,7 @@ public static void check(Context ctx) throws SQLException {\n             ctx.sessionAttribute(\"flash\", \"Проверка успешно выполнена\"); // TODO check message\n             ctx.sessionAttribute(\"flashType\", \"success\");\n \n-        } catch (UnirestException e) {\n+        } catch (UnirestException | NullPointerException e) {\n             ctx.sessionAttribute(\"flash\", \"Не удалось выполнить проверку\"); // TODO check message\n             ctx.sessionAttribute(\"flashType\", \"danger\");\n         }"
        },
        {
            "sha": "fc5dd356238ada16d7a434bf0348ced508941bf6",
            "filename": "app/src/test/java/hexlet/code/AppTest.java",
            "status": "modified",
            "additions": 21,
            "deletions": 1,
            "changes": 22,
            "blob_url": "https://github.com/SerKonstantin/java-project-72/blob/6a4240c9e6d9326d808af031abea8d5a2917facf/app%2Fsrc%2Ftest%2Fjava%2Fhexlet%2Fcode%2FAppTest.java",
            "raw_url": "https://github.com/SerKonstantin/java-project-72/raw/6a4240c9e6d9326d808af031abea8d5a2917facf/app%2Fsrc%2Ftest%2Fjava%2Fhexlet%2Fcode%2FAppTest.java",
            "contents_url": "https://api.github.com/repos/SerKonstantin/java-project-72/contents/app%2Fsrc%2Ftest%2Fjava%2Fhexlet%2Fcode%2FAppTest.java?ref=6a4240c9e6d9326d808af031abea8d5a2917facf",
            "patch": "@@ -2,6 +2,8 @@\n \n import static org.assertj.core.api.Assertions.assertThat;\n \n+//import com.mashape.unirest.http.Unirest;\n+//import com.mashape.unirest.http.exceptions.UnirestException;\n import hexlet.code.database.UrlChecksRepository;\n import hexlet.code.database.UrlsRepository;\n import hexlet.code.model.Url;\n@@ -18,6 +20,7 @@\n import org.junit.jupiter.params.provider.ValueSource;\n \n import java.io.IOException;\n+//import java.net.URI;\n import java.sql.SQLException;\n \n class AppTest {\n@@ -120,7 +123,7 @@ public void testInvalidUrlPage() {\n     }\n \n     @Test\n-    public void testUrlCheck() throws IOException {\n+    public void testUrlCheck() {\n         var mockServerUrl = mockServer.url(\"/\").toString();\n \n         var mockResponse = new MockResponse();\n@@ -149,4 +152,21 @@ public void testUrlCheck() throws IOException {\n             assertThat(urlCheck.getCreatedAt()).isNotNull();\n         }));\n     }\n+\n+//    @Test\n+//    public void testInvalidUrlCheck() throws SQLException, UnirestException {\n+//        var url = new Url(\"invalid_url.invalid_dom\");\n+//        UrlsRepository.save(url);\n+//        var id = url.getId();\n+//\n+//        var response = Unirest.post(\"http://localhost:7070\" + Routes.checkUrlPath(id)).asJson();\n+//        var redirectUrl = response.getHeaders().get(\"location\").get(0);\n+//        if (redirectUrl != null) {\n+//            URI redirectUri = URI.create(redirectUrl);\n+//            response = Unirest.get(redirectUri.toString()).asJson();\n+//        }\n+//\n+//        String responseBody = response.getBody().toString();\n+//        assertThat(responseBody).contains(\"Не удалось выполнить проверку\");\n+//    }\n }"
        }
    ]
}